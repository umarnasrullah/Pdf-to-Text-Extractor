<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smart Portfolio Builder</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>

<body class="bg-light p-4">
    <div class="container">
        <h2 class="text-center mb-4">Smart Portfolio Builder</h2>

        <form id="portfolioForm" class="bg-white p-4 rounded shadow">

            <div class="mb-3">
                <label class="form-label">Full Name</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="nameField" />
                    <button class="btn btn-danger" type="button" onclick="startRecording('nameField')">ðŸŽ¤</button>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">About You</label>
                <div class="input-group">
                    <textarea class="form-control" id="aboutField"></textarea>
                    <button class="btn btn-danger" type="button" onclick="startRecording('aboutField')">ðŸŽ¤</button>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">Skills</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="skillsField" />
                    <button class="btn btn-danger" type="button" onclick="startRecording('skillsField')">ðŸŽ¤</button>
                </div>
            </div>

            <button class="btn btn-primary w-100">Submit</button>
        </form>
    </div>

    <script>
        // ðŸ”´ REPLACE THIS WITH YOUR REAL NGROK URL
        // Example:
        // const MODEL_API = "https://a12b-99-876.ngrok-free.app/transcribe";

        const MODEL_API = "https://unnarrow-pamella-nonsovereignly.ngrok-free.dev/transcribe";


        let mediaRecorder;
        let audioChunks = [];

        async function startRecording(fieldId) {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRecorder = new MediaRecorder(stream);
            mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
            mediaRecorder.onstop = () => sendAudio(fieldId);

            audioChunks = [];
            mediaRecorder.start();

            alert("Recording 3 seconds...");
            setTimeout(() => mediaRecorder.stop(), 3000);
        }

        async function sendAudio(fieldId) {
            const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
            const formData = new FormData();
            formData.append("file", audioBlob, "audio.wav");

            try {
                const response = await fetch(MODEL_API, {
                    method: "POST",
                    body: formData
                });

                const result = await response.json();
                document.getElementById(fieldId).value = result.text;

            } catch (error) {
                alert("Error connecting to your model. Check your ngrok URL.");
                console.error(error);
            }
        }
    </script>

</body>

</html>